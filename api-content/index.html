{"posts":[{"title":"设备硬件功能测试","content":"👏 欢迎使用OpenWrt，本文主要记录基于 OpenWrt 环境下实现的一些设备硬件功能上的简单的测试方案！ 👇 LED 测试 LED 的接口在 /sys/class/leds/ 下面，以 WiFi 的 LED 为例。 👇 RTC 测试 使用 date、hwclock 指令，进行 RTC 时间设置，并读取对比。 👇 Reset 按键测试 输入命令后，按键时有内容输出，则验证通过。 👇 存储设备测试 使用 cp、diff 指令，进行文件读写测试。 👇 网卡网口测试 配置网桥 ping 包方式。 👇 4G/5G 模块测试 修改内核代码，更改 4G/5G 网口名字。 源码增加模块 USB 转串口驱动，option_ids 结构体列表中增加模块的 vid:pid，根据厂家手册，屏蔽对应的 usb 端口，增加了高兴新的 4G、5G 模块 id，同时屏蔽了 3，4，5 的 usb 端口。 问题排查之 lsusb 无法识别。 确定模块是否插入 。 平台 usb 驱动是否正确加载 。 模块是否上电，一般设备有 GPIO 引脚控制模块电源 。 模块有异常，可能是模块没有在正确的工作模式。 ttyUSBx 的枚举。 ttyUSB 接口包含了 at 口和 modem 口，at 口出来后，才能实现拨号联网。 如果 ls /dev/ttyUSB*没有枚举，lsusb 可以识别到模块 id，说明模块的 USB 串口驱动未正确加载。 控制 4G/5G 模块上下电。 常用模块拨号命令。 👇 WIFI 模块测试 通过 lspci 命令，查看模块的型号和 ID 值。 判断驱动是否加载，9287 模块需加载 ath9k 驱动，9882 模块需加载 ath10 驱动，同时系统 /lib/firmware/ath10k 固件目录存在，6174 模块需加载 qca6174 驱动，同时系统 /lib/firmware/qca6174/ 固件目录存在，lsmod 命令查看驱动模块是否加载，cat /proc/bus/pci/devices 也可以看到模块目前已经加载的驱动。 用户态配置工具，在 linux 系统下，需要下面三个用户态工具配置 wifi。 1.iw 命令，用于创建删除无线接口。 2. 当 ap 模式创建无线热点时，需要 hostapd 工具，版本不要低于 2.7。 3. 当 sta 模式时，需要 wpa_supplicant 工具。 Openwrt 系统下配置 wifi。 hostapd 是一个用户态用于 AP 和认证服务器的守护进程。它实现了 IEEE 802.11 相关的接入管理，支持 IEEE 802.1X/WPA/WPA2/EAP 认证，RADIUS 客户端，EAP 服务器和 RADIUS 认证服务器。 hostapd 通过配置文件读取配置参数。 wpa_supplicant 用于连接无线热点，支持支持 IEEE 802.1X/WPA/WPA2 认证。 wpa_supplicant 通过配置读取 wifi 参数。 😘 Thank you for browsing，Enjoy~ ","link":"https://dustmm.github.io/post/hardware/"},{"title":"OpenWrt 编译固件","content":"👏 欢迎使用OpenWrt，OpenWrt 是一个高度可定制化的开源项目，它为嵌入式设备提供了一套强大的操作系统。本教程将指导你如何在自己的系统上编译 OpenWrt，让你能够为你的路由器或其他嵌入式设备创建一个定制的固件！ 👇 前期准备工作 在开始编译 OpenWrt 之前，请确保你的系统满足以下要求： 操作系统：Linux、BSD 或 macOS（Windows 用户可以通过 WSL2 使用 Linux 环境） 处理器：至少 2 GHz 双核处理器。 内存：至少 4 GB RAM 硬盘空间：至少 10 GB 可用空间。 依赖软件：git, gcc, binutils, bzip2, flex, python, perl, make, findutils, grep, sed, awk, diff, patch等。 对于 Ubuntu/Debian 系统，可以通过以下命令安装所需的依赖。对于其他系统，请根据你的发行版安装相应的软件包。 注意千万不要使用 root 用户进行编译操作。 👇 下载仓库源码 由于我使用并非官方 OpenWrt，本文不对下载源码进行过多描述，此部分内容仅供参考。 👇 自定义应用 分享一些个人添加的常用应用。如 diff、i2c-tools、pciutils、usbutils、libstdcpp、jansson（版本需要 2.13.1)、libaio、libevent、mount、wget、fio、lsblk、lscpu、auto-factory、lsscsi、taskset、ntpdate、无线用 hostapd-utils、wireless-tools、wpa-supplicant 等。 介绍一些市面上比较常见使用的插件，按需自行添加。 👇 设备树部分 系统启动需要内核镜像和设备树文件，即 dtb 文件。设备树文件在内核中的 arch/arm64/boot/dts/ 对应平台路径下。客户可以通过 dts 文件，修改 sysfs-led 的控制，gpio-keys 控制，以太网和交换芯片 DSA 等配置。 设备树关于灯的配置。 👇 固件定制化部分 修改 boot 文件，使其开机运行自定义脚本。 修改 login.sh 使其串口登录需要密码。 修改 shadow 文件，实现 root 用户拥有密码密码。 设置默认的 network 配置。 设备 hostname 的修改操作，将 OpenWrt 替换为成你需要的名称。或者直接修改设备的 /etc/config/system 文件。 修改设备默认的 ssid 名字。 设备终端的 banner 修改，可以使用 figlet 工具生成空心字。 修改默认 IP，默认 ip 是 192.168.1.1，我们也可以设置成我们特殊需要的 IP 关于增加luci的操作可以参考链接。 😘 Thank you for browsing，Enjoy~ ","link":"https://dustmm.github.io/post/openwrt/"},{"title":"Linux 个人常用命令","content":"👏 欢迎使用Linux，本文主要记录个人 Linux 使用过程中一些常见常用的命令！ 👉系统相关命令操作👈 👇 查看系统日志 👇 查看系统内核信息 👇 查看系统内核版本 👇 查看当前用户环境变量 👇 查看系统 CPU 信息 查看有几个逻辑 cpu，包括 cpu 型号。 查看有几颗 cpu，每颗分别是几核。 查看当前 CPU 运行在 32bit 还是 64bit 模式下，如果是运行在 32bit 下也不代表 CPU 不支持 64bit 结果大于 0，说明支持 64bit 计算。lm 指 long mode，支持 lm 则是 64bit 👇 SSH 公钥相关 创建公钥私钥，过程中按三次回车，进入 /root/.ssh/ 文件夹，其中 id_rsa 为私钥 id_rsa.pub 为公钥。 删除公钥。 SSH 服务重启。 👇 命令重命名 👇 查看命令路径 👇 后台运行命令 后台运行，并且有 nohup.out 输出。 后台运行，不输出任何日志。 后台运行，并将错误信息做标准输出到日志中。 👇 后台进程相关 查看进程树找到服务器进程。 强制关闭进程名包含 xxx 的所有进程。 👉磁盘，文件，目录相关操作👈 👇 查看磁盘信息 查看磁盘挂载情况。 查看磁盘分区信息。 查看目录及子目录大小。 查看当前目录下各个文件，文件夹占了多少空间，不会递归。 👇 新建文件 👇 新建文件夹 👇 复制文件夹 👇 清空文件内容 👇 建立软连接 👇 WC 命令相关 查看文件里有多少行。 查看文件里有多少个 word。 查看文件里最长的那一行是多少个字。 👇 压缩命令相关 👇 解压命令相关 解压到指定文件夹。 👇 设置文件所属属性 👇 SCP 传输文件 拷贝设备文件到电脑。 拷贝电脑文件到设备。 👇 格式化磁盘 使用自定义脚本来进行格式化操作。 👉网络相关命令操作👈 👇 网络重启 👇 网口相关设置 查看网卡信息。 网卡自适应关闭，并设置网卡的速度为 100Mbps，全双工模式。 网卡自适应开启。 网卡切换 combo 👉Uboot 下相关命令操作👈 👇 Uboot 下读取寄存器 Uboot 下 Mac 信息读取。 😘 Thank you for browsing，Enjoy~ ","link":"https://dustmm.github.io/post/linux/"},{"title":"Samba 服务器的配置","content":"👏 欢迎使用Samba，本文以 Ubuntu 环境为例，Samba 是在 Linux 系统上实现 SMB 协议的一个免费软件，以实现文件共享和打印机服务共享！ 👇 安装 Samba 👇 创建共享目录 👇 创建 Samba 账户 新建 Samba 账户。 管理 Samba 用户。 查看 Samba 账户列表。 👇 设置共享目录权限 设置 root-samba 管理员权限。 设置 hyj-samba 权限。 👇 Samba 服务配置 设置 Samba 服务配置。 重启 Samba 服务。 👇 Windows 测试权限 按键 Ctrl+E，打开此“电脑”，然后点击左侧栏的“网络”，接着在上侧的网络栏目里输入 Samba 地址，然后输入 Samba 账号和密码，就可以登录到 Samba 共享目录了。 默认 Windows 下会保持连接，需断开连接重新登陆。 😘 Thank you for browsing，Enjoy~ ","link":"https://dustmm.github.io/post/samba/"},{"title":"安卓 Termux 软件","content":"👏 欢迎使用Termux，本文以安卓手机为例，请访问官方网站下载！ 👇 安装 Termux 用上面提供的链接下载安装。 👇 更换清华源 👇 设置用户密码 输入 passwd，输入两次要设置的密码。开启 ssh 服务并查看当前内网地址。 👇 设置 Storage 软链接 在 Termux 中输入以下命令，应该会弹框确认是否授权。成功拿到存储权限后，会在 home 目录生成 storage 目录，并且生成若干目录，软连接都指向外置存储卡的相应目录。 值得注意的是，storage 目录下有一个 shared 的目录，在这个 shared 目录中映射到我们手机内部存储的目录。 👇 SSH 远程登录 👇 内网穿透实现 它会创建一个 DNS 解析文件，路径在 $PREFIX/etc/resolv.conf，里面有配置 DNS 解析服务器地址，默认已经加了 8.8.8.8 下载最新的 cpolar 客户端。 官网下获取认证的 token 映射 8000 端口到外网。 👇 安装 Ubuntu 安装 proot-distrot 及 Ubuntu。 登录 Ubuntu。 安装一些必要工具。 配置一下 ssh 的配置，主要是端口，用于区分外部的 ssh 😘 Thank you for browsing，Enjoy~ ","link":"https://dustmm.github.io/post/termux/"},{"title":"GIT 的常用命令操作","content":"👏 欢迎使用GIT，本文主要记录个人常用的 GIT 操作命令！ 👇 GIT 提交操作 将本地修改操作进行提交。 👇 GIT 暂存操作 将本地修改操作进行暂存。 👇 GIT 合并单个提交 需要把 A 分支上提交的部分代码，放在 B 分支上。 👇 GIT 重新提交 撤销最近 n 个提交，变成 add 状态，可以重新提交。 回滚最近 n 个提交，代码彻底删除了，找不回来。 如果上述提交已经推送远程，需要强制推送到远程。 👇 GIT 查看提交修改的文件 查看每条 commoit_id 修改的文件。 👇 GIT 撤销掉远程提交 撤销提交，保留当前工作区。 强制提交当前版本号。 修改代码后，重新提交。 👇 GIT 去除 ^M 的方法 如果 git diff 中存在 ^M，查看当前仓库配置信息。 查看当前用户（global）配置信息。 告诉 GIT 忽略行尾的回车。 😘 Thank you for browsing，Enjoy~ ","link":"https://dustmm.github.io/post/git-use/"},{"title":"WSL 的安装与使用","content":"👏 欢迎使用WSL，Windows 下的 Linux 子系统，个人感觉比安装虚拟机软件来的好用方便，本文以 WSL 安装 Ubuntu-18.04 进行讲解！ 👇 WSL 的安装 设置默认安装 WSL Version 为 2 查看当前可安装发行版。 安装你所需的发行版。 查看 WSL 信息。 👇 WSL 的导入和导出 WSL 的开机和关机操作。 导出虚拟机。 注销原有已经安装的虚拟机 。 导入虚拟机至新位置。 设置默认用户。 👇 WSL 远程连接操作 安装 openssh-server 服务，自带的会有问题，需卸载后重新安装。 配置 SSH 参数。 重启 SSH 服务。 测试 SSH 服务。 配置端口转发规则。 开启 windows 防火墙入站规则。 查看转发端口命令。 删除端口转发命令。 局域网其他电脑登录 WSL。 😘 Thank you for browsing，Enjoy~ ","link":"https://dustmm.github.io/post/wsl-install-use/"},{"title":"Ubuntu 无人值守安装","content":"👏 欢迎使用Ubuntu，本文以X86硬件架构为例，请访问官方镜像站下载！ 👇 Ubuntu 系统启动盘 通过上述下载的镜像，使用 rufus 制作 U 盘启动盘，此过程不做过多赘述！ 👇 U 盘实现无人值守安装 1️⃣ 通过 autoinstall.yaml 文件实现 该方式无需修改 grub.cfg，在启动盘根目录放置 autoinstall.yaml 文件，启动系统后将自行安装系统。 autoinstall.yaml 文件内容如下。 2️⃣ 通过 user-data 文件实现 该方式需修改 grub.cfg，优先级高于 autoinstall.yaml 安装方式，在启动盘根目录放置 user-data 和 meta-data 文件，其中 meta-data 文件是一个以 meta-data 命名的空文件，启动系统后将自行安装系统。 grub.cfg 文件内容需要注意冒号前分号要加上，否则可能导致传递异常截断。 user-data 文件内容如下。 👇 网络无人值守安装 启动盘仅保留启动文件相关的三个目录，boot，casper，EFI，该方式需修改 grub.cfg，启动系统后将自行安装系统。 grub.cfg 文件内容需要注意冒号前分号要加上，否则可能导致传递异常截断。 需要搭建一个 http 服务，并将本文档描述的 meta-data，user-data，iso 镜像（官网下载）放置在 http 文件服务器上。 👇 遇坑记录 网络安装时候，使用的设备网卡需具有唯一 mac，否则自动安装将会失败中断。 使用 user-data 或 autoinstall.yaml 进行无人安装，文件格式需严格按照 yaml 编写，不然会识别不到，导致自动安装异常。 user-data 需要配合修改 grub.cfg，其中 grub.cfg 指定的 ds 参数带的；需要、进行转义，否则同样会导致自动安装异常。 😘 Thank you for browsing，Enjoy~ ","link":"https://dustmm.github.io/post/ubuntu-autoinstall/"},{"title":"Centos 服务器的搭建","content":"👏 欢迎使用Centos，本文以X86硬件架构为例，请访问官方镜像站下载！ 👇 Centos 系统安装 通过上述下载的镜像，使用 rufus 制作 U 盘启动盘，并记录 U 盘盘符，选择 Troubleshooting，添加 grub 启动参数，否则无输出！ 👇 调整默认 LVM 分区 如果你并不是使用这个分区方式，请无视此部分操作。 如果已经挂载，先卸载 /home 目录。 删除逻辑卷 centos-home 调整 centos-swap 逻辑卷的大小为 8GB 扩展 centos-root 逻辑卷以包含剩余空间。 如果 centos-root 包含文件系统，需要调整文件系统大小。 如果是文件系统是 xfs 格式。 缩小分区操作。 确认逻辑卷大小调整和文件系统扩展是否成功。 在 /etc/fstab 中设置自动挂载。 👇 驱动的更新替换 因为我使用的硬件差异，网卡驱动方面需要额外编译二次开发的新驱动替换默认镜像的驱动。 安装 gcc 编译环境，到 gcc 文件夹路径下，rpm 安装编译环境。 ice 驱动，进入 src 目录下，进行编译安装。 ixgbe 驱动，进入 src 目录下，进行编译安装。 igc 驱动，i225、i226 网卡驱动，进入 igc 目录下，进行编译安装。 👇 安装 Libevent 环境 我有工程依赖于 libevent 环境，所以需要安装它，并更新动态链接库。 👇 网口命名方式调整 调整网络接口重新命名回传统的 ethX 格式，可以通过编辑 /etc/default/grub 文件，修改为 net.ifnames=0 👇 系统源失败问题 添加 nameserver，解决网络问题。 删除本地源，下载阿里云配置，解决源问题。 👇 生成 GRUB 配置 重新生成配置，并更新内核参数。 👇 创建公钥私钥 文件位于 /root/.ssh/，其中 id_rsa 为私钥，id_rsa.pub 为公钥，接下来打开 id_rsa.pub，替换至原本的。修改私钥文件的权限，确保只有所有者可以读写，而其他用户没有权限。 👇 安装常用工具 安装一些常用的工具。 修改文件 ~/.bashrc，默认使用高版本 gcc，以及增加 git 命令联想，Tab 自动补全。 👇 同步远程目录 通过 rsync 将远程文件夹同步到本地文件夹。 👇 设置文件夹权限 设置文件夹内只有 root 用户有读写权限，其他人是读权限。 👇 搭建 NFS 服务 安装 NFS 服务器软件包。 配置 NFS 服务器。 启动并设置 NFS 服务器开机自启动。 如果系统使用防火墙，确保允许 NFS 服务通过防火墙。 👇 搭建 FTP 服务 安装 FTP 服务器软件包。 配置 FTP 服务器。 启动并设置 FTP 服务器开机自启动。 如果系统使用防火墙，确保允许 FTP 服务通过防火墙。 👇 搭建 TFTP 服务 安装 TFTP 服务器软件包。 配置 TFTP 服务器。 启动并设置 TFTP 服务器开机自启动。 如果 systemctl 启动服务的时候报错 Error：no space left on device 使配置生效。 如果系统使用防火墙，确保允许 TFTP 服务通过防火墙。 👇 安装宝塔面板 使用宝塔官网安装脚本，SSH关闭宝塔安全入口。 👇 内网穿透服务 使用cpolar实现免费内网穿透。 👇 设置开机自启动 可以通过修改 rc.local，添加一些私有化自启动服务。 👇 安装 Docker 容器 删除 Docker 软件包。 安装 yum-utils 是为方便添加 yum 源使用的，device-mapper-persistent-data 和 lvm2 是储存设备映射 (devicemapper) 必须的两个软件包。 由于默认是国外的 yum 源，基本不可用，我们这边修改为阿里源或清华源。 更新下修改的软件源。 默认版本是 ce 的稳定版本。 安装完成后执行如下命令检测安装是否成功。 阿里云镜像加速器配置。 设置 Docker 自启动。 测试搜索并拉取更新镜像。 如果搜索并拉取更新镜像失败，可以查看服务器 DNS 网络配置。 👇 安装 Nascab 系统 Docker安装Nascab系统，实现私有NAS！ 填坑：文件内权限不足会导致启动 Docker 失败。 设置 Docker 某容器开机自启动。 😘 Thank you for browsing，Enjoy~ ","link":"https://dustmm.github.io/post/centos-server/"}]}